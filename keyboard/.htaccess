RewriteEngine On

# index stop processing
RewriteRule "^index.php$" - [L]

# Rewrite /keyboard/[name][/] to /keyboard/redir.php?q=[name]
# only if index.php does not exist in the folder
#RewriteCond  "%{DOCUMENT_ROOT}/keyboard/$1/index.php" !-f
RewriteCond "%{DOCUMENT_ROOT}/keyboard/$1/index.php" !-f
RewriteRule "^([^/?]+)(/)?$"    "redir.php?q=$1" [L]

# Rewrite /keyboard/[name]/[version][/] to /keyboard/redir.php?q=[name]&amp;v=[version]
# only if index.php does not exist in the folder
RewriteCond "%{DOCUMENT_ROOT}/keyboard/$1/$2/index.php" !-f
RewriteRule "^([^/?]+)/([^/?]+)(/)?$"    "redir.php?q=$1&v=$2" [L]
